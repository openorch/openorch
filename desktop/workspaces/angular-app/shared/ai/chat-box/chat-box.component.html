<!--
 * @license
 * Copyright (c) The Authors (see the AUTHORS file)
 *
 * This source code is licensed under the GNU Affero General Public License v3.0 (AGPLv3) for personal, non-commercial use.
 * You may obtain a copy of the AGPL v3.0 at https://www.gnu.org/licenses/agpl-3.0.html.
 *
 * For commercial use, a separate license must be obtained by purchasing from The Authors.
 * For commercial licensing inquiries, please contact The Authors listed in the AUTHORS file.
 -->
<div class="container-for-ion-card">
	<ion-card class="flat-card">
		<ion-card-content class="main-card">
			<ng-container
				*ngFor="
					let message of messages;
					let i = index;
					let isLast = last;
					trackBy: trackById
				"
			>
				<app-message
					[message]="message"
					[assets]="getAssets(message)"
				></app-message>
			</ng-container>

			<ng-container *ngIf="messageCurrentlyStreamed.content?.length">
				<app-message
					[message]="messageCurrentlyStreamed"
					[streaming]="true"
				></app-message>
			</ng-container>

			<ng-container *ngIf="promptQueue?.length">
				<div style="display: flex; margin-bottom: 1rem; width: 100%">
					<div style="width: 3.5rem; flex-shrink: 0"></div>
					<div style="flex: 1">
						<div
							style="
								max-width: inherit;
								color: #666;
								white-space: nowrap;
								text-overflow: ellipsis;
							"
							*ngFor="let prompt of promptQueue; trackBy: trackById"
						>
							<ng-container *ngIf="prompt.status !== 'running'">{{
								prompt.prompt
							}}</ng-container>
						</div>
					</div>
				</div>
			</ng-container>
		</ion-card-content>

		<ion-item lines="full">
			<div style="display: flex; width: 100%">
				<div style="width: 2.25rem; flex-shrink: 0"></div>
				<div style="flex: 1; display: flex">
					<ion-textarea
						class="sng-test-chat-textarea"
						(keydown)="handleKeydown($event)"
						placeholder="{{ 'Type your message' | translate }}"
						autoGrow="true"
						[(ngModel)]="message"
						style="flex-grow: 1; margin-right: 0rem"
					></ion-textarea>
					<ion-fab-button
						(click)="send()"
						size="small"
						color="primary"
						[disabled]="!hasNonWhiteSpace(message)"
						class="sng-test-chat-send-button"
						style="flex-shrink: 0"
					>
						<span style="color: white">
							<ion-icon
								style="font-size: 1.5rem"
								name="arrow-up-outline"
							></ion-icon>
						</span>
					</ion-fab-button>
				</div>
			</div>
		</ion-item>
	</ion-card>
</div>
