"use strict";(self.webpackChunksingulatron_api_docs=self.webpackChunksingulatron_api_docs||[]).push([[2793],{955814:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var n=r(474848),i=r(28453);const t={sidebar_position:100,tags:["secret-svc","secrets","configuration","services"]},c="Secret Svc",a={id:"built-in-services/secret-svc",title:"Secret Svc",description:"The Secret Svc stores sensitive or internal (non-end-user-facing) configuration. Aims to store all configuration not required at bootstrap, both for internal and external services.",source:"@site/docs/built-in-services/secret-svc.md",sourceDirName:"built-in-services",slug:"/built-in-services/secret-svc",permalink:"/docs/built-in-services/secret-svc",draft:!1,unlisted:!1,editUrl:"https://github.com/openorch/openorch/tree/main/docs-source/docs/built-in-services/secret-svc.md",tags:[{inline:!0,label:"secret-svc",permalink:"/docs/tags/secret-svc"},{inline:!0,label:"secrets",permalink:"/docs/tags/secrets"},{inline:!0,label:"configuration",permalink:"/docs/tags/configuration"},{inline:!0,label:"services",permalink:"/docs/tags/services"}],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100,tags:["secret-svc","secrets","configuration","services"]},sidebar:"tutorialSidebar",previous:{title:"User Svc",permalink:"/docs/built-in-services/user-svc"},next:{title:"Config Svc",permalink:"/docs/built-in-services/config-svc"}},o={},l=[{value:"Access Rules",id:"access-rules",level:2},{value:"Read",id:"read",level:3},{value:"Write",id:"write",level:3},{value:"Create",id:"create",level:4},{value:"Update",id:"update",level:4},{value:"Design choices",id:"design-choices",level:2},{value:"Encryption at rest",id:"encryption-at-rest",level:3}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"secret-svc",children:"Secret Svc"}),"\n",(0,n.jsx)(s.p,{children:"The Secret Svc stores sensitive or internal (non-end-user-facing) configuration. Aims to store all configuration not required at bootstrap, both for internal and external services."}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["This page is a high level overview of the ",(0,n.jsx)(s.code,{children:"Secret Svc"}),". For more details, please see the ",(0,n.jsx)(s.a,{href:"/docs/openorch/list-secrets",children:"Secret Svc API documentation"}),"."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"access-rules",children:"Access Rules"}),"\n",(0,n.jsx)(s.h3,{id:"read",children:"Read"}),"\n",(0,n.jsxs)(s.p,{children:["Any logged in user who is amongst a ",(0,n.jsx)(s.code,{children:"Secret"}),"'s ",(0,n.jsx)(s.code,{children:"Readers"})," can read a secret."]}),"\n",(0,n.jsx)(s.h3,{id:"write",children:"Write"}),"\n",(0,n.jsx)(s.h4,{id:"create",children:"Create"}),"\n",(0,n.jsx)(s.p,{children:"Any logged in user can create a secret. Non-admin users can only create secrets with the key prefixed by their slug, ie:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sh",children:"deploy-svc/EXAMPLE-KEY\n"})}),"\n",(0,n.jsx)(s.p,{children:"vs"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sh",children:"EMAIL_API_KEY\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Obviously the ",(0,n.jsx)(s.code,{children:"EMAIL_API_KEY"})," will be set up by an administrator user."]}),"\n",(0,n.jsx)(s.p,{children:"This prefix rule serves two purposes:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:'It is clear which secret keys are "static" and originating from admin users'}),"\n",(0,n.jsx)(s.li,{children:"It can prevent issues where a user claims a key knowing that it might be used later and overwritten/populated by an admin with sensitive information"}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"update",children:"Update"}),"\n",(0,n.jsxs)(s.p,{children:["After a key is created further write access is governed by the ",(0,n.jsx)(s.code,{children:"Writers"})," block."]}),"\n",(0,n.jsx)(s.h2,{id:"design-choices",children:"Design choices"}),"\n",(0,n.jsx)(s.p,{children:"The Secret Svc, like most things in OpenOrch, is designed to be simple to reason about."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-go",children:'type Secret struct {\n  Id             string\n\tKey            string   // Secret key eg. "MY_API_KEY"\n\tValue          string   // Secret value eg. "nNl4X9\\+@95Z\n\tReaders        []string // Slugs of services and users who can read the secret\n\tWriters        []string // Slugs of services and users who can modify the secret\n  Deleters       []string // Slugs of services and users who can delete the secret\n}\n'})}),"\n",(0,n.jsx)(s.p,{children:"Instead of the OpenOrch injecting environment variables into service containers when they are deployed, the services are left to their own devices to read secrets from the Secret Svc through normal service calls, using their credentials."}),"\n",(0,n.jsx)(s.h3,{id:"encryption-at-rest",children:"Encryption at rest"}),"\n",(0,n.jsxs)(s.p,{children:["All data is encrypted using the encryption key provided by the envar ",(0,n.jsx)(s.code,{children:"OPENORCH_ENCRYPTION_KEY"})," (see Todo section)."]}),"\n",(0,n.jsx)(s.p,{children:"The server encrypts the secret values before saving them to disk/DB. The secret values are transmitted to readers unencrypted."}),"\n",(0,n.jsx)(s.h1,{id:"todo",children:"Todo"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Make it so the encryption key doesn't have to be exposed in an envar"}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);